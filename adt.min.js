// adt.js 
// ------
// Algebraic data types and immutable structures in Javascript
//
// version : 0.5.0
// author  : Nathan Faubion <nathan@n-son.com>
// license : MIT
(function(e){"use strict";var t=Array.prototype.slice,n=Function.prototype.apply;e.util={},e.util.toArray=function(e){var t=[],n=0,r=e.length;for(;n<r;n++)t[n]=e[n];return t},e.util.extend=function(e){var n=t.call(arguments,1);for(var r=0,i=n.length;r<i;r++)for(var s in n[r])n[r].hasOwnProperty(s)&&(e[s]=n[r][s]);return e},e.util.ctrApply=function(e,t){var n=function(){};n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r},e.util.partial=function(n){var r=t.call(arguments,1);return function(){return n.apply(this,r.concat(e.util.toArray(arguments)))}},e.util.inherit=function(e,t){var n=function(){};return n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t},e.util.uniqueId=function(e){return function(t){return t+e++}}(0),e.__Base__=function(){},e.data=function(){var t=typeof arguments[0],r,i,s;if(t==="object")return i=arguments[0],e.data(function(e,t){for(var n in i)t(n,i[n])});r=arguments[0]||function(){},s=[];var o=e.util.inherit(e.__Base__,function(){if(!(this instanceof o)&&o.apply!==n)return o.apply(this,arguments)});o.type=function(t,n){return typeof t!="string"&&(n=t,t=e.util.uniqueId("Anonymous")),n?typeof n!="function"&&(n=e.record(n)):n=e.single(),o.prototype["is"+t]=!1,o[t]=n(o,t),s.push(t),o[t]};var i=r.call(o,o,o.type);if(typeof i=="object"&&!(i instanceof e.__Base__))for(var u in i)i.hasOwnProperty(u)&&o.type(u,i[u]);return o.seal=function(){var e=0,t=s.length,n;for(;e<t;e++)n=this[u].seal,n instanceof Function&&n();return delete o.type,delete o.seal,o},o.__names__=s,o},e.single=function(){var t,n;return t=function(){if(!(this instanceof t))return new t;if(n)return n;n=this},function(r,i){return e.util.inherit(r,t),t.className=i,t.prototype.clone=function(){return n},t.prototype.equals=function(e){return this===e},t.prototype.toString=function(){return i},t.prototype["is"+i]=!0,new t}},e.record=function(){var t=typeof arguments[0],n,r,i,s,o;if(t==="string"){var u=e.util.toArray(arguments);return e.record(function(t,n){var r=0,i=u.length;for(;r<i;r++)n(u[r],e.any)})}return t==="object"?(s=arguments[0],e.record(function(e,t){for(var n in s)t(n,s[n])})):(o=arguments[0]||function(){},n=[],r={},i=function(){var t=e.util.toArray(arguments),s=n.length;if(!(this instanceof i))return t.length<s?e.util.partial.apply(null,[i].concat(t)):e.util.ctrApply(i,t);if(t.length<s)throw new Error("Too few arguments");if(t.length>s)throw new Error("Too many arguments");var o=0,s=t.length,u;for(;o<s;o++)u=n[o],this[u]=r[u](t[o])},function(t,u){e.util.inherit(t,i),i.className=u,i.prototype["is"+u]=!0,i.prototype.toString=function(){var e=i.unapply(this);return u+(e.length?"("+e.join(", ")+")":"")},i.prototype.clone=function(){var t=[],r=0,s=n.length,o;for(;r<s;r++)o=this[n[r]],t.push(o instanceof e.__Base__?o.clone():o);return i.apply(null,t)},i.prototype.get=function(e){if(typeof e=="number"){if(e<0||e>n.length-1)throw new Error("Field index out of range");e=n[e]}else if(!r.hasOwnProperty(e))throw new Error("Field name does not exist");return this[e]},i.prototype.set=function(e){var t=[],r=0,s=n.length,o,u;for(;r<s;r++)u=n[r],o=u in e?e[u]:this[u],t.push(o);return i.apply(null,t)},i.prototype.equals=function(t){if(this===t)return!0;if(t instanceof i){var r=0,s=n.length,o,u,a;for(;r<s;r++){a=n[r],o=this[a],u=t[a];if(o instanceof e.__Base__){if(!o.equals(u))return!1}else if(o!==u)return!1}return!0}return!1},i.create=function(e){var t=[],r=0,s=n.length,o;for(;r<s;r++){o=n[r];if(!(o in e))throw new Error("Could not find field in arguments: "+o);t.push(e[o])}return i.apply(null,t)},i.unapply=function(e){var t=[],r=0,i=n.length;for(;r<i;r++)t.push(e[n[r]]);return t},i.unapplyObj=function(e){var t={},r=0,i=n.length;for(;r<i;r++)t[n[r]]=e[n[r]];return t},i.field=function(t,s){s||(s=e.any);if(typeof s!="function")throw new TypeError("Constraints must be functions");return n.push(t),r[t]=s,i},s=o.call(i,i,i.field);if(typeof s=="object"&&s!==i)for(var u in s){if(!s.hasOwnProperty(u))continue;i.field(u,s[u])}return i.__names__=n,i.__constraints__=r,i.seal=function(){return delete i.field,delete i.seal,i},i})},e.enumeration=function(){function s(e){return e.constructor&&(e=e.constructor),e.__order__=i++,e}function o(e){if(e instanceof r)return!0;throw new TypeError("Unexpected type")}function u(e){return e.constructor.__order__}var t=typeof arguments[0];if(t==="string"){var n=e.util.toArray(arguments);return e.enumeration(function(e,t){var r=0,i=n.length;for(;r<i;r++)t(n[r])})}var r=e.data.apply(null,arguments),i=0,a=0,f=r.__names__.length;for(;a<f;a++)s(r[r.__names__[a]]);var l=r.type;return r.type=function(e,t){return s(l.call(r,e,t))},r.prototype.lt=function(e){return o(e)&&u(this)<u(e)},r.prototype.lte=function(e){return o(e)&&u(this)<=u(e)},r.prototype.gt=function(e){return o(e)&&u(this)>u(e)},r.prototype.gte=function(e){return o(e)&&u(this)>=u(e)},r.prototype.eq=function(e){return o(e)&&u(this)===u(e)},r.prototype.neq=function(e){return o(e)&&u(this)!==u(e)},r},e.newtype=function(){var t=e.util.toArray(arguments),n=e.data();return n.type.apply(n,t)},e.any=function(e){return e},e.only=function(){var t=arguments;return function(n){var r=0,i=t.length,s;for(;r<i;r++){s=t[r];if(s instanceof Function){if(n instanceof s||s===Number&&typeof n=="number"||s===String&&typeof n=="string"||s===Boolean&&typeof n=="boolean")return n}else if(s instanceof e.__Base__&&s.equals(n)||s===n)return n}throw new TypeError("Unexpected type")}}})(typeof exports!="undefined"?exports:this.adt={});