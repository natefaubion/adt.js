// adt.js : Algebraic data types and immutable structures in Javascript
// Nathan Faubion <nathan@n-son.com>
(function(e,t){var n={};e.adt=t.exports=n,n.util={};var r=Array.prototype.slice,i=Function.prototype.apply;n.util.toArray=function(e){return r.call(e)},n.util.extend=function(e){var t=r.call(arguments,1);for(var n=0,i=t.length;n<i;n++)for(var s in t[n])e[s]=t[n][s];return e},n.util.ctrApply=function(e,t){var n=function(){};n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r},n.util.partial=function(e){var t=r.call(arguments,1);return function(){return e.apply(this,t.concat(n.util.toArray(arguments)))}},n.util.curry=function(e,t){return t===undefined&&(t=e.length),function(){var r=n.util.toArray(arguments);if(r.length<t){var i=n.util.partial.apply(this,[e].concat(r));return t-r.length>0?n.util.curry(i,t-r.length):i}return e.apply(this,r)}},n.util.toString=function(){var e=this.constructor,t=e.className||"Anonymous",n=e.unapply(this);return t+(n.length?"("+n.join(", ")+")":"")},n.__Base__=function(){},n.data=function(){var e=typeof arguments[0],t,r,o;if(e==="object")return r=arguments[0],n.data(function(e,t){for(var n in r)t(n,r[n])});t=arguments[0]||function(){},o=[];var u=function(){if(!(this instanceof u)&&u.apply!==i)return u.apply(this,arguments)};u.prototype=new n.__Base__,u.type=function(e,t){typeof e!="string"&&(t=e,e=s("Anonymous")),t?t.prototype instanceof n.__Base__||(t=n.record(t)):t=n.single();var r=t.prototype;return t.prototype=new u,t.prototype.constructor=t,t.prototype.toString=n.util.toString,t.className=e,u.prototype["is"+e]=function(){return this instanceof t},n.util.extend(t.prototype,r),u[e]=t,o.push(e),t};var r=t.call(u,u,u.type);if(typeof r=="object")for(var a in r)u.type(a,r[a]);return u.seel=function(){var e=this;return o.forEach(function(t){var n=e[t].seel;n instanceof Function&&n()}),delete u.type,delete u.seel,u},u.__names__=o,u},n.single=function(){var e,t;return t=function(){if(!(this instanceof t))return new t;if(e)return e;e=this},t.prototype=new n.__Base__,t.prototype.constructor=t,t.prototype.clone=function(){return e},t.prototype.equals=function(e){return this===e},t.create=function(){return t()},t.unapply=function(){return[]},t.unapplyObj=function(){return{}},t},n.record=function(){var e=typeof arguments[0],t,r,i,s,o;if(e==="string"){var u=n.util.toArray(arguments);return s={},u.forEach(function(e){s[e]=null}),n.record(s)}if(e==="object")return s=arguments[0],n.record(function(e,t){for(var n in s)t(n,s[n])});o=arguments[0]||function(){},t=[],r=[],i=function(){var e=n.util.toArray(arguments),s=t.length;if(e.length<s){var o=n.util.partial.apply(this,[i].concat(e));return s-e.length>0?n.util.curry(o,s-e.length):o}if(!(this instanceof i))return n.util.ctrApply(i,e);if(e.length>t.length)throw new Error("Too many arguments");for(var u=0,s=e.length;u<s;u++)this["_"+t[u]]=r[t[u]](e[u])},i.prototype=new n.__Base__,i.prototype.constructor=i,i.prototype.clone=function(){var e=this,r=t.map(function(t){var r=e[t]();return t instanceof n.__Base__?r.clone():r});return i.apply(null,r)},i.prototype.slot=function(e){if(typeof e=="number"){if(e<0||e>t.length-1)throw new Error("Field index out of range");e=t[e]}else if(t.indexOf(e)===-1)throw new Error("Field name does not exist");return this[e]()},i.prototype.set=function(e){var n=this,s=t.map(function(t){var i=t in e?e[t]:n[t]();return r[t](i)});return i.apply(null,s)},i.prototype.equals=function(e){if(this===e)return!0;if(e instanceof i){var r=0,s=t.length,o,u;for(;r<s;r++){o=this[t[r]](),u=e[t[r]]();if(o instanceof n.__Base__){if(!o.equals(u))return!1}else if(o!==u)return!1}}return!0},i.create=function(e){var n=t.map(function(t){if(t in e)return r[t](e[t]);throw new Error("Too few arguments")});return i.apply(null,n)},i.unapply=function(e){return t.map(function(t){return e[t]()})},i.unapplyObj=function(e){var n={};return t.forEach(function(t){n[t]=e[t]()}),n},i.field=function(e,s){s||(s=n.any);if(typeof s!="function")throw new TypeError("Constraints must be functions");return t.push(e),r[e]=s,i},s=o.call(i,i,i.field);if(typeof s=="object")for(var a in s)i.field(a,s[a]);return t.forEach(function(e){i.prototype[e]=function(){return this["_"+e]}}),i.__names__=t,i.__constraints__=r,i.seel=function(){return delete i.field,delete i.seel,i},i},n.any=function(e){return e},n.only=function(){var e=n.util.toArray(arguments);return function(t){var r=0,i=e.length,s;for(;r<i;r++){s=e[r];if(s instanceof Function){if(t instanceof s)return t;if(s===Number&&typeof t=="number")return t;if(s===String&&typeof t=="string")return t;if(s===Boolean&&typeof t=="boolean")return t}else{if(s instanceof n.__Base__&&s.equals(t))return t;if(s===t)return t}}throw new TypeError("Unexpected type")}};var s=function(){var e=0;return function(t){return t+e++}}()})(typeof window!="undefined"?window:{},typeof module!="undefined"?module:{});